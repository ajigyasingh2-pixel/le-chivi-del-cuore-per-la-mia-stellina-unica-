<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Le Chiavi del Cuore 2.0 üîë‚ù§Ô∏è</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        font-family: 'Comic Sans MS', cursive;
        background: linear-gradient(135deg, #ffc1e3, #ff80ab);
    }
    canvas {
        display: block;
        margin: 0 auto;
        background: transparent;
    }

    /* Cuore grande in alto */
    #heart {
        position: absolute;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        width: 180px;
        height: 180px;
        background: radial-gradient(circle at 30% 30%, #ff3366, #cc0033);
        clip-path: polygon(50% 15%, 90% 0, 100% 35%, 50% 100%, 0 35%, 10% 0);
        box-shadow: 0 0 20px #ff99cc, 0 0 50px #ff99cc;
        animation: pulse 1.5s infinite;
        z-index: 1;
    }

    /* Lucchetto sopra il cuore */
    #lock {
        position: absolute;
        top: 80px;
        left: 50%;
        transform: translate(-50%, -120%);
        width: 50px;
        height: 60px;
        background: gold;
        border-radius: 10px;
        z-index: 2;
        box-shadow: 0 0 10px #fff000;
        transition: transform 1s ease, opacity 1s ease;
    }

    #lock::before {
        content: "";
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        width: 35px;
        height: 30px;
        border: 6px solid gold;
        border-bottom: none;
        border-radius: 25px 25px 0 0;
        background: transparent;
    }

    @keyframes pulse {
        0% { transform: translateX(-50%) scale(1); }
        50% { transform: translateX(-50%) scale(1.05); }
        100% { transform: translateX(-50%) scale(1); }
    }

    /* Nuvoletta messaggi */
    #bubble {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 25px;
        padding: 20px 30px;
        max-width: 70%;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        color: #d6005c;
        box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        border: 3px solid #ff6699;
        display: none;
        z-index: 10;
    }

    /* Pulsanti touch */
    #controls {
        position: absolute;
        bottom: 20px;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 20px;
        z-index: 5;
    }

    .btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: none;
        background: #ff6699;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        color: white;
        font-size: 24px;
        font-weight: bold;
    }

    .btn:active { background: #d6005c; }
</style>
</head>
<body>

<canvas id="gameCanvas" width="400" height="600"></canvas>
<div id="heart"></div>
<div id="lock"></div>
<div id="bubble"></div>

<div id="controls">
    <button class="btn" onclick="moveLeft()">‚Üê</button>
    <button class="btn" onclick="moveRight()">‚Üí</button>
</div>

<audio id="successSound" src="https://cdn.pixabay.com/download/audio/2023/05/07/audio_63a70ef1ff.mp3?filename=positive-notification-3-240503.mp3"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let playerX = canvas.width/2 - 20;
let keys = [];
let particles = [];
let level = 1;
let gameActive = true;
let finalUnlocked = false;

const messages = [
    "Ti amo pi√π di qualsiasi altra cosa, stellina ‚ú®",
    "Potrei rimanere ore e ore a guardare i tuoi occhi üíï",
    "Bea, sei la mia felicit√† ogni giorno üíñ",
    "Con te ogni attimo √® magico üåπ",
    "Il mio cuore sar√† sempre tuo, Bea üíò",
    "Sei la mia stella che illumina la notte üåô",
    "Bea, senza di te nulla avrebbe senso üíû",
    "Ogni chiave che trovo mi porta pi√π vicino al tuo cuore üíå",
    "Sei il mio sogno diventato realt√† üå∏",
    "Bea, tu sei la mia chiave per sempre ‚ù§Ô∏è"
];

document.addEventListener("keydown", (e)=>{
    if(e.key==="ArrowLeft") playerX -= 30;
    if(e.key==="ArrowRight") playerX += 30;
});

function moveLeft(){ playerX -= 30; }
function moveRight(){ playerX += 30; }

function spawnKey(){
    let x = Math.random() * (canvas.width-30);
    let good = Math.random() < 0.25;
    keys.push({x: x, y: -30, good: good});
}

function drawPlayer(){
    ctx.fillStyle = "#ff3366";
    ctx.beginPath();
    ctx.moveTo(playerX+20, canvas.height-20);
    ctx.arc(playerX+10, canvas.height-20, 10, Math.PI, 0);
    ctx.arc(playerX+30, canvas.height-20, 10, Math.PI, 0);
    ctx.lineTo(playerX+20, canvas.height);
    ctx.fill();
}

function drawKeys(){
    for(let k of keys){
        ctx.fillStyle = k.good ? "gold" : "silver";
        ctx.fillRect(k.x, k.y, 15, 30);
        ctx.beginPath();
        ctx.arc(k.x+7, k.y-5, 8, 0, Math.PI*2);
        ctx.strokeStyle = k.good ? "gold" : "silver";
        ctx.stroke();
    }
}

function drawParticles(){
    for(let p of particles){
        ctx.fillStyle = `rgba(255,100,150,${p.alpha})`;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        ctx.fill();
    }
}

function update(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    for(let k of keys){
        k.y += 2 + level*0.5;
        if(k.y > canvas.height){
            keys.splice(keys.indexOf(k),1);
        }
        if(k.y+30 > canvas.height-30 && k.x > playerX && k.x < playerX+40){
            if(k.good){
                success();
            } else {
                keys.splice(keys.indexOf(k),1);
            }
        }
    }

    for(let p of particles){
        p.x += p.vx;
        p.y += p.vy;
        p.alpha -= 0.01;
    }
    particles = particles.filter(p => p.alpha > 0);

    drawKeys();
    drawPlayer();
    drawParticles();

    if(gameActive) requestAnimationFrame(update);
}

function typeWriter(text, element, i=0){
    if(i < text.length){
        element.textContent += text.charAt(i);
        setTimeout(()=>typeWriter(text, element, i+1), 60);
    }
}

function success(){
    document.getElementById("successSound").play();
    for(let i=0;i<100;i++){
        particles.push({
            x: 200, y: 100,
            vx: (Math.random()-0.5)*4,
            vy: (Math.random()-0.5)*4,
            size: Math.random()*5+2,
            alpha: 1
        });
    }

    let bubble = document.getElementById("bubble");
    bubble.textContent = "";
    bubble.style.display = "block";
    typeWriter(messages[Math.floor(Math.random()*messages.length)], bubble);

    setTimeout(()=>{ bubble.style.display="none"; }, 5000);

    level++;
    keys = [];

    if(level > 5 && !finalUnlocked){
        finalUnlocked = true;
        unlockFinal();
    }
}

function unlockFinal(){
    let lock = document.getElementById("lock");
    lock.style.transform = "translate(-50%,-120%) rotate(45deg)";
    lock.style.opacity = "0";

    let bubble = document.getElementById("bubble");
    bubble.textContent = "";
    bubble.style.display = "block";
    typeWriter("Bea, tu sei la mia chiave per sempre ‚ù§Ô∏è", bubble);
}

setInterval(spawnKey, 2000);
update();
</script>
</body>
</html>
